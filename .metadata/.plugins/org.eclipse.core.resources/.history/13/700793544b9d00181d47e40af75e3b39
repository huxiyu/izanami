/*
 * izanami-master.c
 *
 *  Created on: 2018年8月11日
 *      Author: caojx
 */

#include "common.h"
#include "config.h"
#include "dictionary.h"
#include "executor.h"
#include "iniparser.h"
#include "izanami-master.h"
#include "masterexecutor.h"

#include <stdlib.h>

void configmaster(struct networkserver *server) {

	dictionary *dict = getdict();
	server->port = iniparser_getint(dict, IZANAMI_MASTER_PORT, 7000);
	server->eth = NULL;
	server->executor = (struct executor*)initmasterexecutor();
}

struct master * initmaster() {

	struct master * ret = (struct master *) malloc(sizeof(struct master));
	ret->networkserver = initnetworkserver(configmaster);
	struct masterexecutor * executor =
			(struct masterexecutor *) (ret->networkserver->executor);
	executor->server = ret;

	return ret;
}
